# å­ä»»åŠ¡åŠŸèƒ½æ•°æ®æµå›¾

## æ•°æ®æµæ€»è§ˆ

### 1. æ·»åŠ å­ä»»åŠ¡æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·è¾“å…¥å‘½ä»¤ â”‚
â”‚ /addsubtask â”‚
â”‚ é¡¹ç›®ID: P1  â”‚
â”‚ ä»»åŠ¡ID: T1  â”‚
â”‚ å­ä»»åŠ¡: è®¾è®¡â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SubtaskHandlers          â”‚
â”‚ cmd_addsubtask()         â”‚
â”‚ - éªŒè¯æƒé™               â”‚
â”‚ - è§£æå‚æ•°               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AddSubtaskTool           â”‚
â”‚ (AI å·¥å…·)                â”‚
â”‚ - å‚æ•°éªŒè¯               â”‚
â”‚ - è°ƒç”¨ DidaClient        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DidaClient.add_subtask_to_task()    â”‚
â”‚                                     â”‚
â”‚ æ­¥éª¤ 1: è·å–å½“å‰ä»»åŠ¡                â”‚
â”‚   get_task(P1, T1)                  â”‚
â”‚   è¿”å›: {title: "å¼€å‘", items: []}  â”‚
â”‚                                     â”‚
â”‚ æ­¥éª¤ 2: è®¡ç®—æ–°æ’åºå·                â”‚
â”‚   if items: max(sortOrder) + 10     â”‚
â”‚   else: 10                          â”‚
â”‚                                     â”‚
â”‚ æ­¥éª¤ 3: åˆ›å»ºæ–°å­ä»»åŠ¡                â”‚
â”‚   new_item = {                      â”‚
â”‚     title: "è®¾è®¡",                  â”‚
â”‚     sortOrder: 10                   â”‚
â”‚   }                                 â”‚
â”‚   âš ï¸ æ³¨æ„ï¼šä¸æŒ‡å®š id                â”‚
â”‚                                     â”‚
â”‚ æ­¥éª¤ 4: æ·»åŠ åˆ° items                â”‚
â”‚   items.append(new_item)            â”‚
â”‚                                     â”‚
â”‚ æ­¥éª¤ 5: æ›´æ–°ä»»åŠ¡                    â”‚
â”‚   update_task(task)                 â”‚
â”‚   API: POST /open/v1/task/{T1}      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API å“åº”                            â”‚
â”‚ {                                   â”‚
â”‚   id: T1,                           â”‚
â”‚   title: "å¼€å‘",                    â”‚
â”‚   items: [                          â”‚
â”‚     {                               â”‚
â”‚       id: "S1",  â† ç³»ç»Ÿç”Ÿæˆ         â”‚
â”‚       title: "è®¾è®¡",                â”‚
â”‚       status: 0,                    â”‚
â”‚       sortOrder: 10                 â”‚
â”‚     }                               â”‚
â”‚   ]                                 â”‚
â”‚ }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ calculate_progress()     â”‚
â”‚ total: 1                 â”‚
â”‚ completed: 0             â”‚
â”‚ progress: 0%             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ format_subtask_list()    â”‚
â”‚                          â”‚
â”‚ ğŸ“‹ å¼€å‘                  â”‚
â”‚ ğŸ“Š è¿›åº¦: 0/1 å®Œæˆ (0%)   â”‚
â”‚ â””â”€ â˜ è®¾è®¡                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘é€æ¶ˆæ¯ç»™ç”¨æˆ·           â”‚
â”‚ âœ… å­ä»»åŠ¡æ·»åŠ æˆåŠŸï¼      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å®Œæˆå­ä»»åŠ¡æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·è¾“å…¥å‘½ä»¤ â”‚
â”‚ /completesubtask â”‚
â”‚ é¡¹ç›®ID: P1  â”‚
â”‚ ä»»åŠ¡ID: T1  â”‚
â”‚ å­ä»»åŠ¡ID: S1â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SubtaskHandlers          â”‚
â”‚ cmd_completesubtask()    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CompleteSubtaskTool      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DidaClient.complete_subtask()       â”‚
â”‚                                     â”‚
â”‚ æ­¥éª¤ 1: è·å–ä»»åŠ¡                    â”‚
â”‚   get_task(P1, T1)                  â”‚
â”‚   è¿”å›åŒ…å« items çš„å®Œæ•´ä»»åŠ¡          â”‚
â”‚                                     â”‚
â”‚ æ­¥éª¤ 2: æŸ¥æ‰¾å­ä»»åŠ¡                  â”‚
â”‚   for item in items:                â”‚
â”‚     if item.id == S1:               â”‚
â”‚       found = item                  â”‚
â”‚                                     â”‚
â”‚ æ­¥éª¤ 3: æ›´æ–°çŠ¶æ€                    â”‚
â”‚   item.status = 1                   â”‚
â”‚   item.completedTime = now()        â”‚
â”‚   // ISO 8601 æ ¼å¼                   â”‚
â”‚                                     â”‚
â”‚ æ­¥éª¤ 4: æ›´æ–°ä»»åŠ¡                    â”‚
â”‚   update_task(task)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¡ç®—è¿›åº¦                             â”‚
â”‚ items = [                           â”‚
â”‚   {id: "S1", status: 1, ...},       â”‚
â”‚   {id: "S2", status: 0, ...}        â”‚
â”‚ ]                                   â”‚
â”‚                                     â”‚
â”‚ total = 2                           â”‚
â”‚ completed = 1                       â”‚
â”‚ progress = 50%                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ format_success_message() â”‚
â”‚                          â”‚
â”‚ âœ… å­ä»»åŠ¡å®Œæˆï¼          â”‚
â”‚                          â”‚
â”‚ ğŸ“‹ å¼€å‘                  â”‚
â”‚ ğŸ“Š è¿›åº¦: 1/2 å®Œæˆ (50%)  â”‚
â”‚ â”œâ”€ â˜‘ï¸ è®¾è®¡ (å·²å®Œæˆ)       â”‚
â”‚ â””â”€ â˜ å¼€å‘                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. åˆ é™¤å­ä»»åŠ¡æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·è¾“å…¥å‘½ä»¤ â”‚
â”‚ /deletesubtask â”‚
â”‚ é¡¹ç›®ID: P1  â”‚
â”‚ ä»»åŠ¡ID: T1  â”‚
â”‚ å­ä»»åŠ¡ID: S1â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SubtaskHandlers          â”‚
â”‚ cmd_deletesubtask()      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äºŒæ¬¡ç¡®è®¤æç¤º             â”‚
â”‚ "ç¡®å®šè¦åˆ é™¤å­ä»»åŠ¡'è®¾è®¡'å—ï¼Ÿâ”‚
â”‚ (y/N)"                   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç¡®è®¤ (y)             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DidaClient.delete_subtask()         â”‚
â”‚                                     â”‚
â”‚ æ­¥éª¤ 1: è·å–ä»»åŠ¡                    â”‚
â”‚   get_task(P1, T1)                  â”‚
â”‚                                     â”‚
â”‚ æ­¥éª¤ 2: è¿‡æ»¤æ‰è¦åˆ é™¤çš„å­ä»»åŠ¡         â”‚
â”‚   new_items = [                     â”‚
â”‚     item for item in items          â”‚
â”‚     if item.id != S1                â”‚
â”‚   ]                                 â”‚
â”‚                                     â”‚
â”‚ æ­¥éª¤ 3: æ›´æ–°ä»»åŠ¡                    â”‚
â”‚   task.items = new_items            â”‚
â”‚   update_task(task)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ format_success_message() â”‚
â”‚                          â”‚
â”‚ ğŸ—‘ï¸ å­ä»»åŠ¡å·²åˆ é™¤          â”‚
â”‚                          â”‚
â”‚ ğŸ“‹ å¼€å‘                  â”‚
â”‚ ğŸ“Š è¿›åº¦: 0/1 å®Œæˆ (0%)   â”‚
â”‚ â””â”€ â˜ å¼€å‘                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ•°æ®ç»“æ„å˜åŒ–

### ä»»åŠ¡åˆ›å»ºæ—¶ï¼ˆæ— å­ä»»åŠ¡ï¼‰

```json
{
  "id": "T1",
  "title": "å¼€å‘ä»»åŠ¡",
  "kind": "TEXT",
  "projectId": "P1",
  "status": 0,
  "items": []
}
```

### æ·»åŠ å­ä»»åŠ¡å

```json
{
  "id": "T1",
  "title": "å¼€å‘ä»»åŠ¡",
  "kind": "CHECKLIST",  â† è‡ªåŠ¨å˜ä¸º CHECKLIST
  "projectId": "P1",
  "status": 0,
  "items": [
    {
      "id": "S1",           â† ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ
      "title": "è®¾è®¡",
      "status": 0,
      "sortOrder": 10
    }
  ]
}
```

### å®Œæˆå­ä»»åŠ¡å

```json
{
  "id": "T1",
  "title": "å¼€å‘ä»»åŠ¡",
  "kind": "CHECKLIST",
  "projectId": "P1",
  "status": 0,
  "items": [
    {
      "id": "S1",
      "title": "è®¾è®¡",
      "status": 1,          â† å˜ä¸ºå·²å®Œæˆ
      "sortOrder": 10,
      "completedTime": "2025-11-16T09:30:00.000+0000"  â† æ·»åŠ å®Œæˆæ—¶é—´
    }
  ]
}
```

## é”™è¯¯å¤„ç†æµç¨‹

```
API è°ƒç”¨å¤±è´¥
    â†“
æ•è·å¼‚å¸¸
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é”™è¯¯ç±»å‹åˆ¤æ–­            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 404 - ä»»åŠ¡ä¸å­˜åœ¨        â”‚ â†’ "ä»»åŠ¡ T1 ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥ä»»åŠ¡ID"
â”‚ 403 - æ— æƒé™            â”‚ â†’ "æ²¡æœ‰æƒé™åœ¨æ­¤é¡¹ç›®ä¸­æ“ä½œ"
â”‚ 400 - è¯·æ±‚æ ¼å¼é”™è¯¯      â”‚ â†’ "è¯·æ±‚æ•°æ®æ ¼å¼é”™è¯¯: ..."
â”‚ ç½‘ç»œè¶…æ—¶                â”‚ â†’ "ç½‘ç»œè¶…æ—¶ï¼Œè¯·é‡è¯•"
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
è®°å½•é”™è¯¯æ—¥å¿—
       â”‚
       â–¼
è¿”å›ç”¨æˆ·å‹å¥½æ¶ˆæ¯
       â”‚
       â–¼
æç¤ºè§£å†³æ–¹æ¡ˆ
```

## æ€§èƒ½ä¼˜åŒ–è¦ç‚¹

### 1. å‡å°‘ API è°ƒç”¨

**é”™è¯¯åšæ³•**ï¼š
```
è·å–ä»»åŠ¡ â†’ æ·»åŠ å­ä»»åŠ¡ â†’ å†æ¬¡è·å–ä»»åŠ¡éªŒè¯
```
3 æ¬¡ API è°ƒç”¨

**æ­£ç¡®åšæ³•**ï¼š
```
è·å–ä»»åŠ¡ â†’ æ·»åŠ å­ä»»åŠ¡ â†’ è¿”å›ç»“æœ
```
2 æ¬¡ API è°ƒç”¨

### 2. æ‰¹é‡æ“ä½œ

**æ·»åŠ å¤šä¸ªå­ä»»åŠ¡**ï¼š
```python
# é”™è¯¯ï¼šé€ä¸ªæ·»åŠ 
for title in subtasks:
    add_subtask(title)  # æ¯æ¬¡éƒ½è°ƒç”¨ API

# æ­£ç¡®ï¼šä¸€æ¬¡æ·»åŠ å¤šä¸ª
items = [{"title": t, "sortOrder": i*10} for i, t in enumerate(subtasks)]
task.items = items
update_task(task)  # åªéœ€ä¸€æ¬¡ API è°ƒç”¨
```

### 3. å¹¶å‘æ§åˆ¶

**é¿å…å¹¶å‘æ›´æ–°å†²çª**ï¼š
```python
# ä½¿ç”¨ä¹è§‚é”
current_version = task.version
update_task(task, expected_version=current_version)
```

## è‡ªç„¶è¯­è¨€äº¤äº’æµç¨‹

```
ç”¨æˆ·: "ç»™é¡¹ç›®å¼€å‘ä»»åŠ¡æ·»åŠ ä¸€ä¸ªå­ä»»åŠ¡å«éœ€æ±‚åˆ†æ"

AI åŠ©æ‰‹:
  â”œâ”€ è§£ææ„å›¾ï¼šæ·»åŠ å­ä»»åŠ¡
  â”œâ”€ æå–å‚æ•°ï¼š
  â”‚   - ä»»åŠ¡åç§°: "é¡¹ç›®å¼€å‘"
  â”‚   - å­ä»»åŠ¡æ ‡é¢˜: "éœ€æ±‚åˆ†æ"
  â”œâ”€ è°ƒç”¨ get_tasks() æŸ¥æ‰¾ä»»åŠ¡
  â”œâ”€ æ‰¾åˆ°ä»»åŠ¡ ID: T1
  â”œâ”€ è°ƒç”¨ add_subtask()
  â””â”€ è¿”å›ç»“æœ:
      âœ… å·²ä¸º"é¡¹ç›®å¼€å‘"ä»»åŠ¡æ·»åŠ å­ä»»åŠ¡"éœ€æ±‚åˆ†æ"
      ğŸ“‹ é¡¹ç›®å¼€å‘
      ğŸ“Š è¿›åº¦: 1/3 å®Œæˆ (33.3%)
      â”œâ”€ â˜‘ï¸ éœ€æ±‚åˆ†æ (åˆšåˆšå®Œæˆ)
      â”œâ”€ â˜ ç³»ç»Ÿè®¾è®¡
      â””â”€ â˜ å¼€å‘å®ç°
```

## å…³é”®ä»£ç ç¤ºä¾‹

### DidaClient.add_subtask_to_task()

```python
async def add_subtask_to_task(
    self,
    project_id: str,
    task_id: str,
    subtask_title: str,
    sort_order: Optional[int] = None
) -> Task:
    """å‘ä»»åŠ¡æ·»åŠ å­ä»»åŠ¡"""
    try:
        # æ­¥éª¤ 1: è·å–å½“å‰ä»»åŠ¡
        task = await self.get_task(project_id, task_id)

        # æ­¥éª¤ 2: è®¡ç®—æ–°çš„ sort_order
        if sort_order is None:
            if task.items:
                max_order = max(item.get("sortOrder", 0) for item in task.items)
                sort_order = max_order + 10
            else:
                sort_order = 10

        # æ­¥éª¤ 3: åˆ›å»ºæ–°å­ä»»åŠ¡ï¼ˆä¸æŒ‡å®š idï¼‰
        new_item = {
            "title": subtask_title,
            "sortOrder": sort_order
        }

        # æ­¥éª¤ 4: æ·»åŠ åˆ° items æ•°ç»„
        task.items.append(new_item)

        # æ­¥éª¤ 5: æ›´æ–°ä»»åŠ¡
        # æ³¨æ„ï¼šå¿…é¡»ä¼ é€’å®Œæ•´çš„ items æ•°ç»„
        return await self.update_task(task)

    except Exception as e:
        raise Exception(f"æ·»åŠ å­ä»»åŠ¡å¤±è´¥: {str(e)}")
```

### è®¡ç®—è¿›åº¦

```python
def calculate_subtask_progress(items: List[Dict]) -> Dict:
    """è®¡ç®—å­ä»»åŠ¡å®Œæˆè¿›åº¦"""
    if not items:
        return {
            "total": 0,
            "completed": 0,
            "pending": 0,
            "progress_percent": 0.0
        }

    total = len(items)
    completed = sum(1 for item in items if item.get("status") == 1)
    pending = total - completed
    progress = (completed / total * 100) if total > 0 else 0

    return {
        "total": total,
        "completed": completed,
        "pending": pending,
        "progress_percent": round(progress, 1)
    }
```

---

**æ•°æ®æµå›¾ç»“æŸ**

è¿™ä¸ªæ•°æ®æµå›¾å±•ç¤ºäº†å­ä»»åŠ¡åŠŸèƒ½çš„æ ¸å¿ƒæ“ä½œæµç¨‹ï¼Œå¯ä»¥ä½œä¸ºå¼€å‘çš„å‚è€ƒæŒ‡å—ã€‚
